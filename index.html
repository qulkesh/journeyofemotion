<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Journey of Emotion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, query, orderBy, getDocs, addDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBEtkJvdmuutC49Iu5gurhl1f-0vrHvUJA",
            authDomain: "journeyofemotio.firebaseapp.com",
            projectId: "journeyofemotio",
            storageBucket: "journeyofemotio.firebasestorage.app",
            messagingSenderId: "845193627977",
            appId: "1:845193627977:web:8c64b747f0e5837742b298",
            measurementId: "G-DJX3P13J68"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Make Firebase available globally
        window.firebase = { auth, db, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile, doc, setDoc, getDoc, updateDoc, collection, query, orderBy, getDocs, addDoc, deleteDoc };
    </script>
    
    <style>
        :root {
            --primary-color: #8b5cf6;
            --primary-hover: #7c3aed;
            --secondary-color: #ec4899;
            --bg-from: #f3e8ff;
            --bg-via: #fdf2f8;
            --bg-to: #dbeafe;
        }

        .theme-purple {
            --primary-color: #8b5cf6;
            --primary-hover: #7c3aed;
            --secondary-color: #ec4899;
            --bg-from: #f3e8ff;
            --bg-via: #fdf2f8;
            --bg-to: #dbeafe;
        }

        .theme-blue {
            --primary-color: #3b82f6;
            --primary-hover: #2563eb;
            --secondary-color: #06b6d4;
            --bg-from: #dbeafe;
            --bg-via: #f0f9ff;
            --bg-to: #cffafe;
        }

        .theme-green {
            --primary-color: #10b981;
            --primary-hover: #059669;
            --secondary-color: #34d399;
            --bg-from: #d1fae5;
            --bg-via: #ecfdf5;
            --bg-to: #f0fdf4;
        }

        .theme-orange {
            --primary-color: #f59e0b;
            --primary-hover: #d97706;
            --secondary-color: #fb923c;
            --bg-from: #fef3c7;
            --bg-via: #fffbeb;
            --bg-to: #ffedd5;
        }

        .theme-rose {
            --primary-color: #e11d48;
            --primary-hover: #be185d;
            --secondary-color: #f43f5e;
            --bg-from: #fecdd3;
            --bg-via: #fff1f2;
            --bg-to: #ffe4e6;
        }

        body {
            background: linear-gradient(to bottom right, var(--bg-from), var(--bg-via), var(--bg-to));
        }

        .primary-bg {
            background-color: var(--primary-color);
        }

        .primary-hover:hover {
            background-color: var(--primary-hover);
        }

        .primary-border {
            border-color: var(--primary-color);
        }

        .primary-text {
            color: var(--primary-color);
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
        }
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: none;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .mobile-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 1rem;
            }
            .mobile-nav {
                flex-direction: row;
                gap: 0.25rem;
            }
            .mobile-nav button {
                flex: 1;
                text-align: center;
                font-size: 0.75rem;
                padding: 0.5rem 0.25rem;
            }
            body {
                padding: 0.5rem;
            }
            .max-w-4xl {
                padding: 0;
            }
        }

        /* Touch improvements */
        button {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        input, textarea {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 0.5rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .emoji-btn {
            padding: 0.5rem;
            border: 2px solid transparent;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 1.5rem;
            text-align: center;
            transition: all 0.2s;
        }

        .emoji-btn:hover {
            border-color: var(--primary-color);
            background-color: rgba(139, 92, 246, 0.1);
        }

        .emoji-btn.selected {
            border-color: var(--primary-color);
            background-color: rgba(139, 92, 246, 0.2);
        }

        .theme-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .theme-btn.active {
            border-color: #374151;
            transform: scale(1.1);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Auth Screen -->
    <div id="authScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Journey of Emotion</h1>
                <p class="text-gray-600">Ğ’Ğ¾Ğ¹Ğ´Ğ¸Ñ‚Ğµ Ğ² ÑĞ²Ğ¾Ğ¹ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚</p>
            </div>

            <!-- Login Form -->
            <div id="loginForm">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="loginEmail" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="your@email.com">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ</label>
                        <input type="password" id="loginPassword" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>
                    <button onclick="login()" id="loginBtn" class="w-full primary-bg primary-hover text-white py-3 rounded-lg font-medium">
                        Ğ’Ğ¾Ğ¹Ñ‚Ğ¸
                    </button>
                </div>
                <div class="mt-6 text-center">
                    <p class="text-gray-600">ĞĞµÑ‚ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚Ğ°? 
                        <button onclick="showRegisterForm()" class="primary-text hover:underline font-medium">Ğ—Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ</button>
                    </p>
                </div>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="hidden">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ğ˜Ğ¼Ñ</label>
                        <input type="text" id="registerName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Ğ’Ğ°ÑˆĞµ Ğ¸Ğ¼Ñ">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="registerEmail" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="your@email.com">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ</label>
                        <input type="password" id="registerPassword" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚Ğµ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ</label>
                        <input type="password" id="confirmPassword" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>
                    <button onclick="register()" id="registerBtn" class="w-full primary-bg primary-hover text-white py-3 rounded-lg font-medium">
                        Ğ—Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ
                    </button>
                </div>
                <div class="mt-6 text-center">
                    <p class="text-gray-600">Ğ£Ğ¶Ğµ ĞµÑÑ‚ÑŒ Ğ°ĞºĞºĞ°ÑƒĞ½Ñ‚? 
                        <button onclick="showLoginForm()" class="primary-text hover:underline font-medium">Ğ’Ğ¾Ğ¹Ñ‚Ğ¸</button>
                    </p>
                </div>
            </div>

            <div id="authError" class="mt-4 p-3 bg-red-100 text-red-700 rounded-lg hidden"></div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <div class="max-w-4xl mx-auto p-4">
            <!-- Header -->
            <div class="text-center mb-6 pt-4">
                <div class="flex justify-between items-center mb-4">
                    <button onclick="showThemeSelector()" class="p-2 rounded-full bg-white shadow-lg hover:shadow-xl transition-all">
                        ğŸ¨
                    </button>
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Journey of Emotion</h1>
                    <div class="flex items-center space-x-2">
                        <button onclick="showView('settings')" class="p-2 rounded-full bg-white shadow-lg hover:shadow-xl transition-all">
                            âš™ï¸
                        </button>
                        <button onclick="logout()" class="p-2 rounded-full bg-white shadow-lg hover:shadow-xl transition-all" title="Ğ’Ñ‹Ğ¹Ñ‚Ğ¸">
                            ğŸšª
                        </button>
                    </div>
                </div>
                <p class="text-gray-600 text-sm md:text-base px-4">ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ¹Ñ‚Ğµ, Ñ€Ğ°Ğ·Ğ¼Ñ‹ÑˆĞ»ÑĞ¹Ñ‚Ğµ Ğ¸ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ğ¹Ñ‚Ğµ ÑĞ²Ğ¾Ğ¸ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹</p>
                <p class="text-gray-500 text-xs mt-1">Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ, <span id="userName"></span>!</p>
            </div>

            <!-- Navigation -->
            <div class="flex justify-center mb-6">
                <div class="bg-white rounded-full p-1 shadow-lg mobile-nav w-full max-w-md flex">
                    <button onclick="showView('log')" id="logBtn" class="flex-1 px-4 py-2 rounded-full transition-all primary-bg text-white shadow-md text-sm">
                        â• Ğ—Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ
                    </button>
                    <button onclick="showView('history')" id="historyBtn" class="flex-1 px-4 py-2 rounded-full transition-all text-gray-600 hover:bg-gray-100 text-sm">
                        ğŸ“… Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ
                    </button>
                    <button onclick="showView('insights')" id="insightsBtn" class="flex-1 px-4 py-2 rounded-full transition-all text-gray-600 hover:bg-gray-100 text-sm">
                        ğŸ“Š ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°
                    </button>
                </div>
            </div>

            <!-- Log View -->
            <div id="logView" class="bg-white rounded-2xl shadow-xl p-4 md:p-8 mx-2 md:max-w-2xl md:mx-auto">
                <h2 class="text-xl md:text-2xl font-semibold text-gray-800 mb-4 md:mb-6 text-center">ĞšĞ°Ğº Ğ²Ñ‹ ÑĞµĞ±Ñ Ñ‡ÑƒĞ²ÑÑ‚Ğ²ÑƒĞµÑ‚Ğµ?</h2>
                
                <!-- Emotion Selection -->
                <div class="mb-4 md:mb-6">
                    <div class="flex justify-between items-center mb-3 md:mb-4">
                        <h3 class="text-base md:text-lg font-medium text-gray-700">Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ¼Ğ¾Ñ†Ğ¸Ñ:</h3>
                        <button onclick="showAddEmotionModal()" class="text-sm primary-text hover:underline">
                            + Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ²Ğ¾Ñ
                        </button>
                    </div>
                    <div id="emotionGrid" class="grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-3 mobile-grid">
                        <!-- Emotions will be rendered here -->
                    </div>
                </div>

                <!-- Intensity Slider -->
                <div id="intensitySection" class="mb-4 md:mb-6 hidden">
                    <h3 class="text-base md:text-lg font-medium text-gray-700 mb-3 md:mb-4">
                        Ğ˜Ğ½Ñ‚ĞµĞ½ÑĞ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ: <span id="intensityValue">5</span>/10
                    </h3>
                    <input type="range" min="1" max="10" value="5" id="intensitySlider" 
                           class="w-full h-3 md:h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
                    <div class="flex justify-between text-xs md:text-sm text-gray-500 mt-1">
                        <span>Ğ¡Ğ»Ğ°Ğ±Ğ¾</span>
                        <span>Ğ¡Ğ¸Ğ»ÑŒĞ½Ğ¾</span>
                    </div>
                </div>

                <!-- Trigger Input -->
                <div id="triggerSection" class="mb-4 md:mb-6 hidden">
                    <h3 class="text-base md:text-lg font-medium text-gray-700 mb-2">Ğ§Ñ‚Ğ¾ Ğ²Ñ‹Ğ·Ğ²Ğ°Ğ»Ğ¾ ÑÑ‚Ñƒ ÑĞ¼Ğ¾Ñ†Ğ¸Ñ?</h3>
                    <input type="text" id="triggerInput" placeholder="Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ğ²ÑÑ‚Ñ€ĞµÑ‡Ğ° Ğ½Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ, Ñ€Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€ Ñ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¼..." 
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm md:text-base">
                </div>

                <!-- Note Input -->
                <div id="noteSection" class="mb-4 md:mb-6 hidden">
                    <h3 class="text-base md:text-lg font-medium text-gray-700 mb-2">Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ¸ (Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾)</h3>
                    <textarea id="noteInput" placeholder="ĞšĞ°Ğº Ğ¾Ñ‰ÑƒÑ‰Ğ°Ğ»Ğ°ÑÑŒ ÑÑ‚Ğ° ÑĞ¼Ğ¾Ñ†Ğ¸Ñ? ĞšĞ°ĞºĞ¸Ğµ Ğ¼Ñ‹ÑĞ»Ğ¸ Ñ Ğ½ĞµĞ¹ Ğ¿Ñ€Ğ¸ÑˆĞ»Ğ¸?" 
                              rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm md:text-base resize-none"></textarea>
                </div>

                <!-- Submit Button -->
                <button id="saveBtn" onclick="saveEntry()" class="w-full primary-bg primary-hover text-white py-3 md:py-3 rounded-lg transition-colors font-medium shadow-lg hidden text-sm md:text-base">
                    <span id="saveBtnText">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ</span>
                    <span id="saveBtnLoader" class="loading hidden"></span>
                </button>
            </div>

            <!-- History View -->
            <div id="historyView" class="bg-white rounded-2xl shadow-xl p-4 md:p-8 mx-2 hidden">
                <h2 class="text-xl md:text-2xl font-semibold text-gray-800 mb-4 md:mb-6">Ğ’Ğ°ÑˆĞµ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¿ÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²Ğ¸Ğµ</h2>
                <div id="historyContent">
                    <div class="text-center py-12">
                        <div class="loading mx-auto mb-4"></div>
                        <p class="text-gray-500">Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ...</p>
                    </div>
                </div>
            </div>

            <!-- Insights View -->
            <div id="insightsView" class="bg-white rounded-2xl shadow-xl p-4 md:p-8 mx-2 hidden">
                <h2 class="text-xl md:text-2xl font-semibold text-gray-800 mb-4 md:mb-6">Ğ­Ğ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°</h2>
                <div id="insightsContent">
                    <div class="text-center py-12">
                        <div class="loading mx-auto mb-4"></div>
                        <p class="text-gray-500">Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºÑƒ...</p>
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div id="settingsView" class="bg-white rounded-2xl shadow-xl p-4 md:p-8 mx-2 hidden">
                <h2 class="text-xl md:text-2xl font-semibold text-gray-800 mb-4 md:mb-6">ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸</h2>
                
                <div class="space-y-6">
                    <!-- Profile -->
                    <div>
                        <h3 class="text-lg font-medium text-gray-700 mb-3">ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p class="text-gray-600">Email: <span id="userEmail" class="font-medium"></span></p>
                            <p class="text-gray-600">Ğ˜Ğ¼Ñ: <span id="userDisplayName" class="font-medium"></span></p>
                        </div>
                    </div>

                    <!-- Theme Selection -->
                    <div>
                        <h3 class="text-lg font-medium text-gray-700 mb-3">Ğ¦Ğ²ĞµÑ‚Ğ¾Ğ²Ğ°Ñ Ñ‚ĞµĞ¼Ğ°</h3>
                        <div class="flex space-x-3">
                            <button onclick="changeTheme('purple')" class="theme-btn theme-purple" style="background: linear-gradient(45deg, #8b5cf6, #ec4899)" data-theme="purple"></button>
                            <button onclick="changeTheme('blue')" class="theme-btn theme-blue" style="background: linear-gradient(45deg, #3b82f6, #06b6d4)" data-theme="blue"></button>
                            <button onclick="changeTheme('green')" class="theme-btn theme-green" style="background: linear-gradient(45deg, #10b981, #34d399)" data-theme="green"></button>
                            <button onclick="changeTheme('orange')" class="theme-btn theme-orange" style="background: linear-gradient(45deg, #f59e0b, #fb923c)" data-theme="orange"></button>
                            <button onclick="changeTheme('rose')" class="theme-btn theme-rose" style="background: linear-gradient(45deg, #e11d48, #f43f5e)" data-theme="rose"></button>
                        </div>
                    </div>

                    <!-- Custom Emotions Management -->
                    <div>
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="text-lg font-medium text-gray-700">Ğ’Ğ°ÑˆĞ¸ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¸</h3>
                            <button onclick="showAddEmotionModal()" class="primary-bg primary-hover text-white px-4 py-2 rounded-lg text-sm">
                                Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¼Ğ¾Ñ†Ğ¸Ñ
                            </button>
                        </div>
                        <div id="customEmotionsList" class="space-y-2">
                            <!-- Custom emotions will be listed here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Psychology Tips Section -->
            <div class="mt-8 bg-white rounded-2xl shadow-xl p-4 md:p-6 mx-2">
                <div class="text-center mb-4">
                    <h3 class="text-lg md:text-xl font-semibold text-gray-800 mb-2">ğŸ’¡ Ğ¡Ğ¾Ğ²ĞµÑ‚ Ğ¿ÑĞ¸Ñ…Ğ¾Ğ»Ğ¾Ğ³Ğ°</h3>
                    <div id="psychologyTip" class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-lg">
                        <p id="tipText" class="text-gray-700 text-sm md:text-base italic mb-2">Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ ÑĞ¾Ğ²ĞµÑ‚...</p>
                        <p id="tipAuthor" class="text-gray-600 text-xs md:text-sm">â€”</p>
                    </div>
                    <div class="mt-3 flex justify-center space-x-2">
                        <button onclick="loadNewTip()" class="primary-bg primary-hover text-white px-4 py-2 rounded-lg text-sm">
                            ĞĞ¾Ğ²Ñ‹Ğ¹ ÑĞ¾Ğ²ĞµÑ‚
                        </button>
                        <div class="flex items-center text-xs text-gray-500">
                            <span id="countdown">30</span>s
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Theme Selector Modal -->
    <div id="themeModal" class="modal">
        <div class="bg-white rounded-2xl p-6 m-4 max-w-sm w-full">
            <h3 class="text-lg font-semibold mb-4">Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ‚ĞµĞ¼Ñƒ</h3>
            <div class="grid grid-cols-3 gap-3 mb-4">
                <button onclick="changeTheme('purple')" class="theme-btn mx-auto theme-purple" style="background: linear-gradient(45deg, #8b5cf6, #ec4899)" data-theme="purple"></button>
                <button onclick="changeTheme('blue')" class="theme-btn mx-auto theme-blue" style="background: linear-gradient(45deg, #3b82f6, #06b6d4)" data-theme="blue"></button>
                <button onclick="changeTheme('green')" class="theme-btn mx-auto theme-green" style="background: linear-gradient(45deg, #10b981, #34d399)" data-theme="green"></button>
                <button onclick="changeTheme('orange')" class="theme-btn mx-auto theme-orange" style="background: linear-gradient(45deg, #f59e0b, #fb923c)" data-theme="orange"></button>
                <button onclick="changeTheme('rose')" class="theme-btn mx-auto theme-rose" style="background: linear-gradient(45deg, #e11d48, #f43f5e)" data-theme="rose"></button>
            </div>
            <button onclick="closeThemeModal()" class="w-full bg-gray-200 text-gray-800 py-2 rounded-lg">
                Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ
            </button>
        </div>
    </div>

    <!-- Add Emotion Modal -->
    <div id="addEmotionModal" class="modal">
        <div class="bg-white rounded-2xl p-6 m-4 max-w-md w-full">
            <h3 class="text-lg font-semibold mb-4">Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²ÑƒÑ ÑĞ¼Ğ¾Ñ†Ğ¸Ñ</h3>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¸</label>
                <input type="text" id="emotionNameInput" placeholder="ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: Ğ’Ğ´Ğ¾Ñ…Ğ½Ğ¾Ğ²ĞµĞ½Ğ¸Ğµ" 
                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
            </div>

            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸</label>
                <div class="emoji-grid" id="emojiGrid">
                    <!-- Emojis will be generated here -->
                </div>
            </div>

            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Ğ’Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ°Ñ ÑĞ¼Ğ¾Ñ†Ğ¸Ñ</label>
                <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                    <div id="selectedEmojiPreview" class="w-8 h-8 flex items-center justify-center text-2xl">â“</div>
                    <span id="selectedEmotionNamePreview" class="text-gray-500">Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ¸ Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</span>
                </div>
            </div>

            <div class="flex space-x-3">
                <button onclick="addCustomEmotion()" class="flex-1 primary-bg primary-hover text-white py-2 rounded-lg">
                    <span id="addEmotionBtnText">Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ</span>
                    <span id="addEmotionLoader" class="loading hidden"></span>
                </button>
                <button onclick="closeAddEmotionModal()" class="flex-1 bg-gray-200 text-gray-800 py-2 rounded-lg">
                    ĞÑ‚Ğ¼ĞµĞ½Ğ°
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let entries = [];
        let selectedEmotion = '';
        let currentTheme = 'purple';
        let selectedEmoji = '';

        // Default emotions
        const defaultEmotions = {
            joy: { name: 'Ğ Ğ°Ğ´Ğ¾ÑÑ‚ÑŒ', color: 'bg-yellow-400', emoji: 'â˜€ï¸', isDefault: true },
            love: { name: 'Ğ›ÑĞ±Ğ¾Ğ²ÑŒ', color: 'bg-pink-400', emoji: 'â¤ï¸', isDefault: true },
            excitement: { name: 'Ğ’Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ', color: 'bg-orange-400', emoji: 'âš¡', isDefault: true },
            calm: { name: 'Ğ¡Ğ¿Ğ¾ĞºĞ¾Ğ¹ÑÑ‚Ğ²Ğ¸Ğµ', color: 'bg-blue-400', emoji: 'â˜ï¸', isDefault: true },
            neutral: { name: 'ĞĞµĞ¹Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ğ¾', color: 'bg-gray-400', emoji: 'ğŸ˜', isDefault: true },
            sadness: { name: 'Ğ“Ñ€ÑƒÑÑ‚ÑŒ', color: 'bg-blue-600', emoji: 'ğŸŒ§ï¸', isDefault: true },
            anger: { name: 'Ğ“Ğ½ĞµĞ²', color: 'bg-red-500', emoji: 'ğŸ˜ ', isDefault: true },
            anxiety: { name: 'Ğ¢Ñ€ĞµĞ²Ğ¾Ğ³Ğ°', color: 'bg-purple-500', emoji: 'ğŸ˜°', isDefault: true }
        };

        let customEmotions = {};
        let emotions = { ...defaultEmotions };

        // Available emojis for selection
        const availableEmojis = [
            'ğŸ˜€', 'ğŸ˜ƒ', 'ğŸ˜„', 'ğŸ˜', 'ğŸ˜†', 'ğŸ˜…', 'ğŸ˜‚', 'ğŸ¤£',
            'ğŸ˜Š', 'ğŸ˜‡', 'ğŸ™‚', 'ğŸ™ƒ', 'ğŸ˜‰', 'ğŸ˜Œ', 'ğŸ˜', 'ğŸ¥°',
            'ğŸ˜˜', 'ğŸ˜—', 'â˜ºï¸', 'ğŸ˜š', 'ğŸ˜™', 'ğŸ¥²', 'ğŸ˜‹', 'ğŸ˜›',
            'ğŸ˜œ', 'ğŸ¤ª', 'ğŸ˜', 'ğŸ¤‘', 'ğŸ¤—', 'ğŸ¤­', 'ğŸ¤«', 'ğŸ¤”',
            'ğŸ¤', 'ğŸ¤¨', 'ğŸ˜', 'ğŸ˜‘', 'ğŸ˜¶', 'ğŸ˜', 'ğŸ˜’', 'ğŸ™„',
            'ğŸ˜¬', 'ğŸ¤¥', 'ğŸ˜”', 'ğŸ˜ª', 'ğŸ¤¤', 'ğŸ˜´', 'ğŸ˜·', 'ğŸ¤’',
            'ğŸ¤•', 'ğŸ¤¢', 'ğŸ¤®', 'ğŸ¤§', 'ğŸ¥µ', 'ğŸ¥¶', 'ğŸ¥´', 'ğŸ˜µ',
            'ğŸ¤¯', 'ğŸ¤ ', 'ğŸ¥³', 'ğŸ¥¸', 'ğŸ˜', 'ğŸ¤“', 'ğŸ§', 'ğŸ˜•',
            'ğŸ˜Ÿ', 'ğŸ™', 'â˜¹ï¸', 'ğŸ˜®', 'ğŸ˜¯', 'ğŸ˜²', 'ğŸ˜³', 'ğŸ¥º',
            'ğŸ˜¦', 'ğŸ˜§', 'ğŸ˜¨', 'ğŸ˜°', 'ğŸ˜¥', 'ğŸ˜¢', 'ğŸ˜­', 'ğŸ˜±',
            'ğŸ˜–', 'ğŸ˜£', 'ğŸ˜', 'ğŸ˜“', 'ğŸ˜©', 'ğŸ˜«', 'ğŸ¥±', 'ğŸ˜¤',
            'ğŸ˜¡', 'ğŸ˜ ', 'ğŸ¤¬', 'ğŸ˜ˆ', 'ğŸ‘¿', 'ğŸ’€', 'â˜ ï¸', 'ğŸ’©',
            'ğŸ¤¡', 'ğŸ‘¹', 'ğŸ‘º', 'ğŸ‘»', 'ğŸ‘½', 'ğŸ‘¾', 'ğŸ¤–', 'ğŸ­',
            'ğŸ’«', 'â­', 'ğŸŒŸ', 'âœ¨', 'âš¡', 'ğŸ’¥', 'ğŸ’¢', 'ğŸ’¯',
            'ğŸ’¤', 'ğŸ’¨', 'ğŸ¤', 'ğŸ–¤', 'â¤ï¸', 'ğŸ§¡', 'ğŸ’›', 'ğŸ’š',
            'ğŸ’™', 'ğŸ’œ', 'ğŸ¤', 'ğŸ’”', 'â£ï¸', 'ğŸ’•', 'ğŸ’', 'ğŸ’“',
            'ğŸ’—', 'ğŸ’–', 'ğŸ’˜', 'ğŸ’', 'ğŸ’Ÿ', 'â˜®ï¸', 'âœï¸', 'â˜ªï¸',
            'ğŸ•‰ï¸', 'â˜¸ï¸', 'âœ¡ï¸', 'ğŸ”¯', 'ğŸ•', 'â˜¯ï¸', 'â˜¦ï¸', 'ğŸ›'
        ];

        // Firebase Authentication Functions
        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showAuthError('ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ğ²ÑĞµ Ğ¿Ğ¾Ğ»Ñ');
                return;
            }

            const loginBtn = document.getElementById('loginBtn');
            loginBtn.innerHTML = '<span class="loading"></span> Ğ’Ñ…Ğ¾Ğ´...';
            loginBtn.disabled = true;

            try {
                const userCredential = await window.firebase.signInWithEmailAndPassword(window.firebase.auth, email, password);
                currentUser = userCredential.user;
                hideAuthError();
                await loadUserData();
                showMainApp();
            } catch (error) {
                console.error('Login error:', error);
                showAuthError(getAuthErrorMessage(error.code));
            } finally {
                loginBtn.innerHTML = 'Ğ’Ğ¾Ğ¹Ñ‚Ğ¸';
                loginBtn.disabled = false;
            }
        }

        async function register() {
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (!name || !email || !password || !confirmPassword) {
                showAuthError('ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ğ²ÑĞµ Ğ¿Ğ¾Ğ»Ñ');
                return;
            }

            if (password !== confirmPassword) {
                showAuthError('ĞŸĞ°Ñ€Ğ¾Ğ»Ğ¸ Ğ½Ğµ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°ÑÑ‚');
                return;
            }

            if (password.length < 6) {
                showAuthError('ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 6 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²');
                return;
            }

            const registerBtn = document.getElementById('registerBtn');
            registerBtn.innerHTML = '<span class="loading"></span> Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ...';
            registerBtn.disabled = true;

            try {
                const userCredential = await window.firebase.createUserWithEmailAndPassword(window.firebase.auth, email, password);
                currentUser = userCredential.user;
                
                // Update profile with display name
                await window.firebase.updateProfile(currentUser, {
                    displayName: name
                });

                // Initialize user data in Firestore
                await initializeUserData(name);
                
                hideAuthError();
                await loadUserData();
                showMainApp();
            } catch (error) {
                console.error('Register error:', error);
                showAuthError(getAuthErrorMessage(error.code));
            } finally {
                registerBtn.innerHTML = 'Ğ—Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ';
                registerBtn.disabled = false;
            }
        }

        async function logout() {
            try {
                await window.firebase.signOut(window.firebase.auth);
                currentUser = null;
                entries = [];
                customEmotions = {};
                emotions = { ...defaultEmotions };
                showAuthScreen();
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        function showAuthError(message) {
            const errorDiv = document.getElementById('authError');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function hideAuthError() {
            document.getElementById('authError').classList.add('hidden');
        }

        function getAuthErrorMessage(errorCode) {
            switch (errorCode) {
                case 'auth/user-not-found':
                    return 'ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ñ Ñ‚Ğ°ĞºĞ¸Ğ¼ email Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½';
                case 'auth/wrong-password':
                    return 'ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€Ğ¾Ğ»ÑŒ';
                case 'auth/email-already-in-use':
                    return 'ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ñ Ñ‚Ğ°ĞºĞ¸Ğ¼ email ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚';
                case 'auth/weak-password':
                    return 'ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ ÑĞ»Ğ°Ğ±Ñ‹Ğ¹';
                case 'auth/invalid-email':
                    return 'ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ email';
                default:
                    return 'ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ°. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ ĞµÑ‰Ğµ Ñ€Ğ°Ğ·';
            }
        }

        function showLoginForm() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
            hideAuthError();
        }

        function showRegisterForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            hideAuthError();
        }

        function showAuthScreen() {
            document.getElementById('authScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        function showMainApp() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            // Update user info
            document.getElementById('userName').textContent = currentUser.displayName || 'ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ';
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('userDisplayName').textContent = currentUser.displayName || 'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¾';
        }

        // Firebase Data Functions
        async function initializeUserData(displayName) {
            const userDoc = window.firebase.doc(window.firebase.db, 'users', currentUser.uid);
            await window.firebase.setDoc(userDoc, {
                displayName: displayName,
                email: currentUser.email,
                theme: 'purple',
                createdAt: new Date(),
                customEmotions: {}
            });
        }

        async function loadUserData() {
            try {
                console.log('Loading user data for:', currentUser.uid);
                
                // Load user settings
                const userDoc = window.firebase.doc(window.firebase.db, 'users', currentUser.uid);
                const userSnap = await window.firebase.getDoc(userDoc);
                
                if (userSnap.exists()) {
                    const userData = userSnap.data();
                    console.log('User data loaded:', userData);
                    
                    currentTheme = userData.theme || 'purple';
                    customEmotions = userData.customEmotions || {};
                    
                    // Merge default and custom emotions
                    emotions = { ...defaultEmotions };
                    Object.keys(customEmotions).forEach(key => {
                        emotions[key] = customEmotions[key];
                    });
                    
                    console.log('Custom emotions loaded:', customEmotions);
                    console.log('All emotions:', emotions);
                    
                    changeTheme(currentTheme);
                } else {
                    console.log('No user document found, creating one...');
                    // Create initial user document
                    await window.firebase.setDoc(userDoc, {
                        displayName: currentUser.displayName || 'ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ',
                        email: currentUser.email,
                        theme: 'purple',
                        createdAt: new Date(),
                        customEmotions: {}
                    });
                }

                // Load entries
                await loadEntries();
                
                renderEmotions();
                console.log('User data loading complete');
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        async function loadEntries() {
            try {
                const entriesRef = window.firebase.collection(window.firebase.db, 'users', currentUser.uid, 'entries');
                const q = window.firebase.query(entriesRef, window.firebase.orderBy('timestamp', 'desc'));
                const querySnapshot = await window.firebase.getDocs(q);
                
                entries = [];
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    entries.push({
                        id: doc.id,
                        ...data,
                        timestamp: data.timestamp.toDate() // Convert Firestore timestamp to Date
                    });
                });
            } catch (error) {
                console.error('Error loading entries:', error);
                entries = [];
            }
        }

        async function saveUserSettings() {
            try {
                console.log('Saving user settings...', {
                    theme: currentTheme,
                    customEmotions: customEmotions
                });
                
                const userDoc = window.firebase.doc(window.firebase.db, 'users', currentUser.uid);
                await window.firebase.updateDoc(userDoc, {
                    theme: currentTheme,
                    customEmotions: customEmotions
                });
                
                console.log('User settings saved successfully');
            } catch (error) {
                console.error('Error saving user settings:', error);
                // Try to create the document if it doesn't exist
                try {
                    await window.firebase.setDoc(userDoc, {
                        displayName: currentUser.displayName || 'ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ',
                        email: currentUser.email,
                        theme: currentTheme,
                        createdAt: new Date(),
                        customEmotions: customEmotions
                    });
                    console.log('User document created and settings saved');
                } catch (createError) {
                    console.error('Error creating user document:', createError);
                }
            }
        }

        // Theme management
        async function changeTheme(theme) {
            currentTheme = theme;
            document.body.className = `min-h-screen theme-${theme}`;
            updateActiveThemeButton();
            closeThemeModal();
            
            if (currentUser) {
                await saveUserSettings();
            }
        }

        function updateActiveThemeButton() {
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll(`[data-theme="${currentTheme}"]`).forEach(btn => {
                btn.classList.add('active');
            });
        }

        function showThemeSelector() {
            document.getElementById('themeModal').classList.add('show');
            updateActiveThemeButton();
        }

        function closeThemeModal() {
            document.getElementById('themeModal').classList.remove('show');
        }

        // Emotion management
        function renderEmotions() {
            const emotionGrid = document.getElementById('emotionGrid');
            let html = '';
            
            Object.keys(emotions).forEach(key => {
                const emotion = emotions[key];
                html += `
                    <button onclick="selectEmotion('${key}')" class="emotion-btn p-3 md:p-4 rounded-xl border-2 border-gray-200 hover:border-gray-300 transition-all" data-emotion="${key}">
                        <div class="w-6 h-6 md:w-8 md:h-8 ${emotion.color} rounded-full mx-auto mb-1 md:mb-2 flex items-center justify-center">
                            <span class="text-white text-sm md:text-lg">${emotion.emoji}</span>
                        </div>
                        <span class="text-xs md:text-sm font-medium text-gray-700">${emotion.name}</span>
                    </button>
                `;
            });
            
            emotionGrid.innerHTML = html;
        }

        function showAddEmotionModal() {
            document.getElementById('addEmotionModal').classList.add('show');
            renderEmojiGrid();
            resetEmotionForm();
        }

        function closeAddEmotionModal() {
            document.getElementById('addEmotionModal').classList.remove('show');
        }

        function renderEmojiGrid() {
            const emojiGrid = document.getElementById('emojiGrid');
            let html = '';
            
            availableEmojis.forEach(emoji => {
                html += `<button class="emoji-btn" onclick="selectEmoji('${emoji}')">${emoji}</button>`;
            });
            
            emojiGrid.innerHTML = html;
        }

        function selectEmoji(emoji) {
            selectedEmoji = emoji;
            
            // Update selected state
            document.querySelectorAll('.emoji-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // Update preview
            document.getElementById('selectedEmojiPreview').textContent = emoji;
            updateEmotionPreview();
        }

        function updateEmotionPreview() {
            const name = document.getElementById('emotionNameInput').value;
            const preview = document.getElementById('selectedEmotionNamePreview');
            
            if (name && selectedEmoji) {
                preview.textContent = name;
                preview.className = 'text-gray-800 font-medium';
            } else {
                preview.textContent = 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ¸ Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ';
                preview.className = 'text-gray-500';
            }
        }

        function resetEmotionForm() {
            document.getElementById('emotionNameInput').value = '';
            selectedEmoji = '';
            document.getElementById('selectedEmojiPreview').textContent = 'â“';
            document.getElementById('selectedEmotionNamePreview').textContent = 'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ¸ Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ';
            document.getElementById('selectedEmotionNamePreview').className = 'text-gray-500';
            
            document.querySelectorAll('.emoji-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
        }

        async function addCustomEmotion() {
            const name = document.getElementById('emotionNameInput').value.trim();
            
            if (!name || !selectedEmoji) {
                alert('ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸');
                return;
            }

            const addBtn = document.getElementById('addEmotionBtnText');
            const loader = document.getElementById('addEmotionLoader');
            
            addBtn.classList.add('hidden');
            loader.classList.remove('hidden');

            try {
                const emotionId = 'custom_' + Date.now();
                const colors = ['bg-purple-400', 'bg-indigo-400', 'bg-blue-400', 'bg-green-400', 'bg-yellow-400', 'bg-red-400', 'bg-pink-400', 'bg-teal-400'];
                const randomColor = colors[Math.floor(Math.random() * colors.length)];

                const newEmotion = {
                    name: name,
                    color: randomColor,
                    emoji: selectedEmoji,
                    isDefault: false
                };

                // Add to local objects
                customEmotions[emotionId] = newEmotion;
                emotions[emotionId] = newEmotion;
                
                console.log('Adding custom emotion:', emotionId, newEmotion);
                console.log('Updated customEmotions:', customEmotions);
                
                // Save to Firebase
                await saveUserSettings();
                
                // Update UI
                renderEmotions();
                renderCustomEmotionsList();
                closeAddEmotionModal();
                
                console.log('Custom emotion added successfully');
            } catch (error) {
                console.error('Error adding custom emotion:', error);
                alert('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¸ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¸: ' + error.message);
            } finally {
                addBtn.classList.remove('hidden');
                loader.classList.add('hidden');
            }
        }

        async function deleteCustomEmotion(emotionId) {
            if (confirm('Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ñƒ ÑĞ¼Ğ¾Ñ†Ğ¸Ñ?')) {
                try {
                    console.log('Deleting custom emotion:', emotionId);
                    
                    // Remove from local objects
                    delete customEmotions[emotionId];
                    delete emotions[emotionId];
                    
                    console.log('Updated customEmotions after delete:', customEmotions);
                    
                    // Save to Firebase
                    await saveUserSettings();
                    
                    // Update UI
                    renderEmotions();
                    renderCustomEmotionsList();
                    
                    console.log('Custom emotion deleted successfully');
                } catch (error) {
                    console.error('Error deleting custom emotion:', error);
                    alert('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğ¸ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¸: ' + error.message);
                }
            }
        }

        function renderCustomEmotionsList() {
            const container = document.getElementById('customEmotionsList');
            let html = '';
            
            Object.keys(customEmotions).forEach(key => {
                const emotion = customEmotions[key];
                html += `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <span class="text-2xl">${emotion.emoji}</span>
                            <span class="font-medium">${emotion.name}</span>
                        </div>
                        <button onclick="deleteCustomEmotion('${key}')" class="text-red-600 hover:text-red-800 text-sm">
                            Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ
                        </button>
                    </div>
                `;
            });
            
            if (html === '') {
                html = '<p class="text-gray-500 text-center py-4">ĞŸĞ¾ĞºĞ° Ğ½ĞµÑ‚ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ñ… ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¹</p>';
            }
            
            container.innerHTML = html;
        }

        // Navigation
        function showView(view) {
            // Hide all views
            document.getElementById('logView').classList.add('hidden');
            document.getElementById('historyView').classList.add('hidden');
            document.getElementById('insightsView').classList.add('hidden');
            document.getElementById('settingsView').classList.add('hidden');

            // Reset button styles
            document.querySelectorAll('button[id$="Btn"]').forEach(btn => {
                btn.className = 'flex-1 px-4 py-2 rounded-full transition-all text-gray-600 hover:bg-gray-100 text-sm';
            });

            // Show selected view and update button
            document.getElementById(view + 'View').classList.remove('hidden');
            if (view !== 'settings') {
                document.getElementById(view + 'Btn').className = 'flex-1 px-4 py-2 rounded-full transition-all primary-bg text-white shadow-md text-sm';
            }

            if (view === 'history') {
                displayHistory();
            } else if (view === 'insights') {
                displayInsights();
            } else if (view === 'settings') {
                renderCustomEmotionsList();
                updateActiveThemeButton();
            }
        }

        // Emotion selection
        function selectEmotion(emotion) {
            selectedEmotion = emotion;
            
            // Update button styles
            document.querySelectorAll('.emotion-btn').forEach(btn => {
                btn.className = 'emotion-btn p-3 md:p-4 rounded-xl border-2 border-gray-200 hover:border-gray-300 transition-all';
            });
            
            document.querySelector('[data-emotion="' + emotion + '"]').className = 'emotion-btn p-3 md:p-4 rounded-xl border-2 primary-border shadow-lg scale-105 transition-all';

            // Show additional sections
            document.getElementById('intensitySection').classList.remove('hidden');
            document.getElementById('triggerSection').classList.remove('hidden');
            document.getElementById('noteSection').classList.remove('hidden');
            document.getElementById('saveBtn').classList.remove('hidden');
        }

        // Intensity slider
        document.addEventListener('DOMContentLoaded', function() {
            const intensitySlider = document.getElementById('intensitySlider');
            if (intensitySlider) {
                intensitySlider.addEventListener('input', function() {
                    document.getElementById('intensityValue').textContent = this.value;
                });
            }

            const emotionNameInput = document.getElementById('emotionNameInput');
            if (emotionNameInput) {
                emotionNameInput.addEventListener('input', updateEmotionPreview);
            }
        });

        // Save entry
        async function saveEntry() {
            if (!selectedEmotion || !currentUser) return;

            const saveBtnText = document.getElementById('saveBtnText');
            const saveBtnLoader = document.getElementById('saveBtnLoader');
            
            saveBtnText.classList.add('hidden');
            saveBtnLoader.classList.remove('hidden');

            try {
                const entry = {
                    emotion: selectedEmotion,
                    intensity: parseInt(document.getElementById('intensitySlider').value),
                    trigger: document.getElementById('triggerInput').value,
                    note: document.getElementById('noteInput').value,
                    timestamp: new Date()
                };

                // Save to Firestore
                const entriesRef = window.firebase.collection(window.firebase.db, 'users', currentUser.uid, 'entries');
                const docRef = await window.firebase.addDoc(entriesRef, entry);
                
                // Add to local array with document ID
                entry.id = docRef.id;
                entries.unshift(entry);

                // Reset form
                resetEntryForm();
                alert('Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ°!');
            } catch (error) {
                console.error('Error saving entry:', error);
                alert('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğ¸ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸');
            } finally {
                saveBtnText.classList.remove('hidden');
                saveBtnLoader.classList.add('hidden');
            }
        }

        function resetEntryForm() {
            selectedEmotion = '';
            document.querySelectorAll('.emotion-btn').forEach(btn => {
                btn.className = 'emotion-btn p-3 md:p-4 rounded-xl border-2 border-gray-200 hover:border-gray-300 transition-all';
            });
            
            document.getElementById('intensitySlider').value = 5;
            document.getElementById('intensityValue').textContent = '5';
            document.getElementById('triggerInput').value = '';
            document.getElementById('noteInput').value = '';
            
            document.getElementById('intensitySection').classList.add('hidden');
            document.getElementById('triggerSection').classList.add('hidden');
            document.getElementById('noteSection').classList.add('hidden');
            document.getElementById('saveBtn').classList.add('hidden');
        }

        // Display history
        function displayHistory() {
            const historyContent = document.getElementById('historyContent');
            
            if (entries.length === 0) {
                historyContent.innerHTML = '<div class="text-center py-12"><div class="text-6xl mb-4">ğŸ“–</div><p class="text-gray-500 text-lg">ĞŸĞ¾ĞºĞ° Ğ½ĞµÑ‚ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹. ĞĞ°Ñ‡Ğ½Ğ¸Ñ‚Ğµ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ ÑĞ²Ğ¾Ğ¸ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¸!</p></div>';
                return;
            }

            let html = '<div class="space-y-4">';
            for (let i = 0; i < entries.length; i++) {
                const entry = entries[i];
                const emotion = emotions[entry.emotion] || { name: 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ ÑĞ¼Ğ¾Ñ†Ğ¸Ñ', color: 'bg-gray-400', emoji: 'â“' };
                
                // Fix date formatting issue
                let date;
                try {
                    if (entry.timestamp instanceof Date) {
                        date = entry.timestamp.toLocaleString('ru-RU');
                    } else if (entry.timestamp && entry.timestamp.toDate) {
                        date = entry.timestamp.toDate().toLocaleString('ru-RU');
                    } else {
                        date = new Date(entry.timestamp).toLocaleString('ru-RU');
                    }
                } catch (error) {
                    console.error('Date formatting error:', error);
                    date = 'Ğ”Ğ°Ñ‚Ğ° Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°';
                }
                
                html += '<div class="border border-gray-200 rounded-lg p-3 md:p-4 hover:shadow-md transition-shadow">';
                html += '<div class="flex items-start space-x-3 md:space-x-4">';
                html += '<div class="w-10 h-10 md:w-12 md:h-12 ' + emotion.color + ' rounded-full flex items-center justify-center flex-shrink-0">';
                html += '<span class="text-white text-lg md:text-xl">' + emotion.emoji + '</span>';
                html += '</div>';
                html += '<div class="flex-1 min-w-0">';
                html += '<div class="flex items-center justify-between mb-2">';
                html += '<h3 class="text-base md:text-lg font-medium text-gray-800 truncate">' + emotion.name + '</h3>';
                html += '<span class="text-xs md:text-sm text-gray-500 flex-shrink-0 ml-2">' + date + '</span>';
                html += '</div>';
                html += '<div class="mb-2">';
                html += '<span class="text-xs md:text-sm text-gray-600">Ğ˜Ğ½Ñ‚ĞµĞ½ÑĞ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ: </span>';
                html += '<span class="font-medium text-sm md:text-base">' + entry.intensity + '/10</span>';
                html += '</div>';
                
                if (entry.trigger) {
                    html += '<div class="mb-2">';
                    html += '<span class="text-xs md:text-sm text-gray-600">Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€: </span>';
                    html += '<span class="text-gray-800 text-sm md:text-base break-words">' + entry.trigger + '</span>';
                    html += '</div>';
                }
                
                if (entry.note) {
                    html += '<p class="text-gray-700 text-xs md:text-sm bg-gray-50 p-2 md:p-3 rounded-lg break-words">' + entry.note + '</p>';
                }
                
                html += '</div>';
                html += '</div>';
                html += '</div>';
            }
            html += '</div>';
            
            historyContent.innerHTML = html;
        }

        // Display insights
        function displayInsights() {
            const insightsContent = document.getElementById('insightsContent');
            
            if (entries.length === 0) {
                insightsContent.innerHTML = '<div class="text-center py-12"><div class="text-6xl mb-4">ğŸ“Š</div><p class="text-gray-500 text-lg">ĞĞ°Ñ‡Ğ½Ğ¸Ñ‚Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ñ‚ÑŒ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¸, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑƒĞ²Ğ¸Ğ´ĞµÑ‚ÑŒ Ğ°Ğ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºÑƒ!</p></div>';
                return;
            }

            // Calculate statistics
            const emotionCounts = {};
            const totalIntensity = {};
            
            for (let i = 0; i < entries.length; i++) {
                const entry = entries[i];
                emotionCounts[entry.emotion] = (emotionCounts[entry.emotion] || 0) + 1;
                totalIntensity[entry.emotion] = (totalIntensity[entry.emotion] || 0) + entry.intensity;
            }

            const avgIntensity = {};
            for (const emotion in emotionCounts) {
                avgIntensity[emotion] = totalIntensity[emotion] / emotionCounts[emotion];
            }

            // Most common emotions
            let commonEmotionsHtml = '<div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">';
            const sortedEmotions = Object.entries(emotionCounts).sort((a, b) => b[1] - a[1]).slice(0, 4);
            
            for (let i = 0; i < sortedEmotions.length; i++) {
                const emotionKey = sortedEmotions[i][0];
                const count = sortedEmotions[i][1];
                const emotionData = emotions[emotionKey] || { name: 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ', color: 'bg-gray-400', emoji: 'â“' };
                
                commonEmotionsHtml += '<div class="text-center p-3 md:p-4 border border-gray-200 rounded-lg">';
                commonEmotionsHtml += '<div class="w-10 h-10 md:w-12 md:h-12 ' + emotionData.color + ' rounded-full mx-auto mb-2 flex items-center justify-center">';
                commonEmotionsHtml += '<span class="text-white text-lg md:text-xl">' + emotionData.emoji + '</span>';
                commonEmotionsHtml += '</div>';
                commonEmotionsHtml += '<h4 class="font-medium text-gray-800 text-sm md:text-base">' + emotionData.name + '</h4>';
                commonEmotionsHtml += '<p class="text-xs md:text-sm text-gray-600">' + count + ' Ñ€Ğ°Ğ·</p>';
                commonEmotionsHtml += '</div>';
            }
            commonEmotionsHtml += '</div>';

            // Average intensity
            let avgIntensityHtml = '<div class="space-y-3">';
            const sortedAvgIntensity = Object.entries(avgIntensity).sort((a, b) => b[1] - a[1]);
            
            for (let i = 0; i < sortedAvgIntensity.length; i++) {
                const emotionKey = sortedAvgIntensity[i][0];
                const avg = sortedAvgIntensity[i][1];
                const emotionData = emotions[emotionKey] || { name: 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ', color: 'bg-gray-400', emoji: 'â“' };
                const percentage = (avg / 10) * 100;
                
                avgIntensityHtml += '<div class="flex items-center space-x-3">';
                avgIntensityHtml += '<div class="w-6 h-6 md:w-8 md:h-8 ' + emotionData.color + ' rounded-full flex items-center justify-center flex-shrink-0">';
                avgIntensityHtml += '<span class="text-white text-xs md:text-sm">' + emotionData.emoji + '</span>';
                avgIntensityHtml += '</div>';
                avgIntensityHtml += '<div class="flex-1 min-w-0">';
                avgIntensityHtml += '<div class="flex justify-between items-center">';
                avgIntensityHtml += '<span class="font-medium text-gray-800 text-sm md:text-base truncate">' + emotionData.name + '</span>';
                avgIntensityHtml += '<span class="text-xs md:text-sm text-gray-600 flex-shrink-0 ml-2">' + avg.toFixed(1) + '/10</span>';
                avgIntensityHtml += '</div>';
                avgIntensityHtml += '<div class="w-full bg-gray-200 rounded-full h-2 mt-1">';
                avgIntensityHtml += '<div class="h-2 rounded-full ' + emotionData.color + '" style="width: ' + percentage + '%"></div>';
                avgIntensityHtml += '</div>';
                avgIntensityHtml += '</div>';
                avgIntensityHtml += '</div>';
            }
            avgIntensityHtml += '</div>';

            insightsContent.innerHTML = '<div class="space-y-6 md:space-y-8"><div><h3 class="text-lg md:text-xl font-medium text-gray-800 mb-3 md:mb-4">Ğ¡Ğ°Ğ¼Ñ‹Ğµ Ñ‡Ğ°ÑÑ‚Ñ‹Ğµ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¸</h3>' + commonEmotionsHtml + '</div><div><h3 class="text-lg md:text-xl font-medium text-gray-800 mb-3 md:mb-4">Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ Ğ¸Ğ½Ñ‚ĞµĞ½ÑĞ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾ ÑĞ¼Ğ¾Ñ†Ğ¸ÑĞ¼</h3>' + avgIntensityHtml + '</div><div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 md:p-6 rounded-lg"><h3 class="text-lg md:text-xl font-medium text-gray-800 mb-2">Ğ¡Ğ²Ğ¾Ğ´ĞºĞ° Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Ğ¿ÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²Ğ¸Ñ</h3><p class="text-gray-700 text-sm md:text-base">Ğ’Ñ‹ Ğ·Ğ°Ğ¿Ğ¸ÑĞ°Ğ»Ğ¸ ' + entries.length + ' ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¹. ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°Ğ¹Ñ‚Ğµ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ»ÑƒÑ‡ÑˆĞµ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ñ‚ÑŒ ÑĞ²Ğ¾Ğ¸ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ¸ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğµ!</p></div></div>';
        }

        // Psychology Tips functionality
        let tipTimer;
        let countdownInterval;

        const psychologyTips = [
            {
                text: "Ğ”Ñ‹ÑˆĞ¸Ñ‚Ğµ Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ¾. ĞšĞ¾Ğ³Ğ´Ğ° Ğ²Ñ‹ Ñ‡ÑƒĞ²ÑÑ‚Ğ²ÑƒĞµÑ‚Ğµ ÑÑ‚Ñ€ĞµÑÑ Ğ¸Ğ»Ğ¸ Ñ‚Ñ€ĞµĞ²Ğ¾Ğ³Ñƒ, ÑĞ´ĞµĞ»Ğ°Ğ¹Ñ‚Ğµ 5 Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ¸Ñ… Ğ²Ğ´Ğ¾Ñ…Ğ¾Ğ². Ğ­Ñ‚Ğ¾ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿Ğ°Ñ€Ğ°ÑĞ¸Ğ¼Ğ¿Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºÑƒÑ Ğ½ĞµÑ€Ğ²Ğ½ÑƒÑ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ğ¸ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ ÑƒÑĞ¿Ğ¾ĞºĞ¾Ğ¸Ñ‚ÑŒÑÑ.",
                author: "Ğ¢ĞµÑ…Ğ½Ğ¸ĞºĞ° Ğ´Ñ‹Ñ…Ğ°Ğ½Ğ¸Ñ"
            },
            {
                text: "ĞŸÑ€Ğ°ĞºÑ‚Ğ¸ĞºÑƒĞ¹Ñ‚Ğµ Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€Ğ½Ğ¾ÑÑ‚ÑŒ. ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ·Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ğ¹Ñ‚Ğµ 3 Ğ²ĞµÑ‰Ğ¸, Ğ·Ğ° ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ²Ñ‹ Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ´Ğ°Ñ€Ğ½Ñ‹. Ğ­Ñ‚Ğ¾ Ğ¼ĞµĞ½ÑĞµÑ‚ Ñ„Ğ¾ĞºÑƒÑ Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ Ñ Ğ½ĞµĞ³Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ½Ğ° Ğ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¸Ğ²Ğ½Ğ¾Ğµ.",
                author: "ĞŸĞ¾Ğ·Ğ¸Ñ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ¿ÑĞ¸Ñ…Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ"
            },
            {
                text: "Ğ’Ğ°ÑˆĞ¸ Ğ¼Ñ‹ÑĞ»Ğ¸ - ÑÑ‚Ğ¾ Ğ½Ğµ Ñ„Ğ°ĞºÑ‚Ñ‹. ĞšĞ¾Ğ³Ğ´Ğ° Ğ¿Ñ€Ğ¸Ñ…Ğ¾Ğ´ÑÑ‚ Ğ½ĞµĞ³Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¼Ñ‹ÑĞ»Ğ¸, ÑĞ¿Ñ€Ğ¾ÑĞ¸Ñ‚Ğµ ÑĞµĞ±Ñ: 'Ğ­Ñ‚Ğ¾ Ğ¿Ñ€Ğ°Ğ²Ğ´Ğ°? Ğ•ÑÑ‚ÑŒ Ğ»Ğ¸ Ğ´Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ĞµĞ»ÑŒÑÑ‚Ğ²Ğ°?' Ğ§Ğ°ÑÑ‚Ğ¾ Ğ½Ğ°ÑˆĞ¸ ÑÑ‚Ñ€Ğ°Ñ…Ğ¸ Ğ¿Ñ€ĞµÑƒĞ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ñ‹.",
                author: "ĞšĞ¾Ğ³Ğ½Ğ¸Ñ‚Ğ¸Ğ²Ğ½Ğ¾-Ğ¿Ğ¾Ğ²ĞµĞ´ĞµĞ½Ñ‡ĞµÑĞºĞ°Ñ Ñ‚ĞµÑ€Ğ°Ğ¿Ğ¸Ñ"
            },
            {
                text: "Ğ”Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ - ÑÑ‚Ğ¾ Ğ»ĞµĞºĞ°Ñ€ÑÑ‚Ğ²Ğ¾ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ·Ğ³Ğ°. Ğ”Ğ°Ğ¶Ğµ 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ñ…Ğ¾Ğ´ÑŒĞ±Ñ‹ Ğ¼Ğ¾Ğ³ÑƒÑ‚ ÑƒĞ»ÑƒÑ‡ÑˆĞ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ Ğ¸ ÑĞ½Ğ¸Ğ·Ğ¸Ñ‚ÑŒ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ ÑÑ‚Ñ€ĞµÑÑĞ°.",
                author: "ĞĞµĞ¹Ñ€Ğ¾Ğ¿ÑĞ¸Ñ…Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ"
            },
            {
                text: "Ğ“Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğµ Ñ ÑĞ¾Ğ±Ğ¾Ğ¹ ĞºĞ°Ğº Ñ Ğ»ÑƒÑ‡ÑˆĞ¸Ğ¼ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¼. Ğ—Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚Ğµ ÑĞ°Ğ¼Ğ¾ĞºÑ€Ğ¸Ñ‚Ğ¸ĞºÑƒ Ğ½Ğ° ÑĞ¾ÑÑ‚Ñ€Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ Ğº ÑĞµĞ±Ğµ. Ğ­Ñ‚Ğ¾ Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞ°ĞµÑ‚ ÑĞ°Ğ¼Ğ¾Ğ¾Ñ†ĞµĞ½ĞºÑƒ Ğ¸ Ğ¿ÑĞ¸Ñ…Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒĞµ.",
                author: "Ğ¡Ğ°Ğ¼Ğ¾ÑĞ¾ÑÑ‚Ñ€Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ"
            },
            {
                text: "ĞŸÑ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ¹Ñ‚Ğµ ÑĞ²Ğ¾Ğ¸ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¸. ĞĞµ Ğ¿Ñ‹Ñ‚Ğ°Ğ¹Ñ‚ĞµÑÑŒ Ğ¿Ğ¾Ğ´Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ¸Ğ»Ğ¸ Ğ¸Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ°. ĞŸÑ€Ğ¸Ğ·Ğ½Ğ°Ğ½Ğ¸Ğµ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¹ - Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ ÑˆĞ°Ğ³ Ğº Ğ¸Ñ… Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²Ğ¾Ğ¹ Ğ¿ĞµÑ€ĞµÑ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ.",
                author: "Ğ­Ğ¼Ğ¾Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¸Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚"
            },
            {
                text: "ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ÑŒÑ‚Ğµ Ğ²Ñ€ĞµĞ¼Ñ Ğ² ÑĞ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… ÑĞµÑ‚ÑÑ…. ĞŸĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ½Ğ¾Ğµ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼Ğ¸ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ½ĞµĞ³Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾ Ğ²Ğ»Ğ¸ÑÑ‚ÑŒ Ğ½Ğ° ÑĞ°Ğ¼Ğ¾Ğ¾Ñ†ĞµĞ½ĞºÑƒ Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ.",
                author: "Ğ¦Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ¾Ğµ Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğµ"
            },
            {
                text: "ĞŸÑ€Ğ°ĞºÑ‚Ğ¸ĞºÑƒĞ¹Ñ‚Ğµ Ğ¾ÑĞ¾Ğ·Ğ½Ğ°Ğ½Ğ½Ğ¾ÑÑ‚ÑŒ. Ğ‘ÑƒĞ´ÑŒÑ‚Ğµ Ğ² Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰ĞµĞ¼ Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚Ğµ. ĞšĞ¾Ğ³Ğ´Ğ° ÑƒĞ¼ Ğ±Ğ»ÑƒĞ¶Ğ´Ğ°ĞµÑ‚ Ğ² Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾Ğ¼ Ğ¸Ğ»Ğ¸ Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ¼, Ğ¼ÑĞ³ĞºĞ¾ Ğ²ĞµÑ€Ğ½Ğ¸Ñ‚Ğµ Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ Ğº 'Ğ·Ğ´ĞµÑÑŒ Ğ¸ ÑĞµĞ¹Ñ‡Ğ°Ñ'.",
                author: "ĞœĞ°Ğ¹Ğ½Ğ´Ñ„ÑƒĞ»Ğ½ĞµÑÑ"
            },
            {
                text: "ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°Ğ¹Ñ‚Ğµ ÑĞ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ²ÑĞ·Ğ¸. ĞšĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ - Ğ¾Ğ´Ğ¸Ğ½ Ğ¸Ğ· Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ñ… Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¾Ğ² ÑÑ‡Ğ°ÑÑ‚ÑŒÑ Ğ¸ Ğ¿ÑĞ¸Ñ…Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ.",
                author: "Ğ¡Ğ¾Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¿ÑĞ¸Ñ…Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ"
            },
            {
                text: "Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹. Ğ£Ñ‡Ğ¸Ñ‚ĞµÑÑŒ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ÑŒ 'Ğ½ĞµÑ‚'. Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° ÑĞ²Ğ¾ĞµĞ³Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ¸ ÑĞ½ĞµÑ€Ğ³Ğ¸Ğ¸ - ÑÑ‚Ğ¾ Ğ½Ğµ ÑĞ³Ğ¾Ğ¸Ğ·Ğ¼, Ğ° Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ´Ğ»Ñ Ğ¿ÑĞ¸Ñ…Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²ÑŒÑ.",
                author: "ĞŸÑĞ¸Ñ…Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ†"
            },
            {
                text: "Ğ’ĞµĞ´Ğ¸Ñ‚Ğµ Ğ´Ğ½ĞµĞ²Ğ½Ğ¸Ğº. ĞŸĞ¸ÑÑŒĞ¼ĞµĞ½Ğ½Ğ¾Ğµ Ğ²Ñ‹Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¼Ñ‹ÑĞ»ĞµĞ¹ Ğ¸ Ñ‡ÑƒĞ²ÑÑ‚Ğ² Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ĞµÑ‚ Ğ¸Ñ… ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¸ Ğ»ÑƒÑ‡ÑˆĞµ Ğ¿Ğ¾Ğ½ÑÑ‚ÑŒ ÑĞµĞ±Ñ.",
                author: "Ğ­ĞºÑĞ¿Ñ€ĞµÑÑĞ¸Ğ²Ğ½Ğ¾Ğµ Ğ¿Ğ¸ÑÑŒĞ¼Ğ¾"
            },
            {
                text: "Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ğ¹Ñ‚Ğµ Ñ€Ğ¸Ñ‚ÑƒĞ°Ğ»Ñ‹. Ğ ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¸ÑÑ‚Ğ½Ñ‹Ğµ Ñ€Ğ¸Ñ‚ÑƒĞ°Ğ»Ñ‹ (ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğ¹ ĞºĞ¾Ñ„Ğµ, Ğ²ĞµÑ‡ĞµÑ€Ğ½ÑÑ Ğ²Ğ°Ğ½Ğ½Ğ°) ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ Ğ¾Ñ‰ÑƒÑ‰ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ğ¸ ĞºĞ¾Ğ¼Ñ„Ğ¾Ñ€Ñ‚Ğ°.",
                author: "ĞŸĞ¾Ğ²ĞµĞ´ĞµĞ½Ñ‡ĞµÑĞºĞ°Ñ Ğ¿ÑĞ¸Ñ…Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ"
            }
        ];

        async function loadPsychologyTip() {
            try {
                // ĞŸÑ‹Ñ‚Ğ°ĞµĞ¼ÑÑ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ¸Ğ· API
                const response = await fetch('https://zenquotes.io/api/random');
                if (response.ok) {
                    const data = await response.json();
                    if (data && data.length > 0) {
                        document.getElementById('tipText').textContent = data[0].q;
                        document.getElementById('tipAuthor').textContent = `â€” ${data[0].a}`;
                        return;
                    }
                }
            } catch (error) {
                console.log('API Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹');
            }

            // Ğ•ÑĞ»Ğ¸ API Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ¾Ğ²ĞµÑ‚Ñ‹
            const randomTip = psychologyTips[Math.floor(Math.random() * psychologyTips.length)];
            document.getElementById('tipText').textContent = randomTip.text;
            document.getElementById('tipAuthor').textContent = `â€” ${randomTip.author}`;
        }

        function loadNewTip() {
            loadPsychologyTip();
            resetTipTimer();
        }

        function startTipTimer() {
            let countdown = 30;
            const countdownElement = document.getElementById('countdown');
            
            if (countdownElement) {
                countdownInterval = setInterval(() => {
                    countdown--;
                    countdownElement.textContent = countdown;
                    
                    if (countdown <= 0) {
                        loadPsychologyTip();
                        countdown = 30;
                    }
                }, 1000);
            }

            tipTimer = setInterval(() => {
                loadPsychologyTip();
            }, 30000);
        }

        function resetTipTimer() {
            if (tipTimer) clearInterval(tipTimer);
            if (countdownInterval) clearInterval(countdownInterval);
            startTipTimer();
        }

        // Initialize app
        function initApp() {
            // Check if Firebase is loaded
            if (!window.firebase) {
                console.error('Firebase not loaded. Please check your Firebase configuration.');
                document.getElementById('authScreen').innerHTML = '<div class="min-h-screen flex items-center justify-center p-4"><div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md text-center"><h2 class="text-2xl font-bold text-gray-800 mb-4">ĞÑˆĞ¸Ğ±ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸</h2><p class="text-gray-600 mb-4">ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹Ñ‚Ğµ Firebase ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ² ĞºĞ¾Ğ´Ğµ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ.</p><p class="text-sm text-gray-500">Ğ—Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚Ğµ firebaseConfig Ğ½Ğ° Ğ²Ğ°ÑˆĞ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Firebase.</p></div></div>';
                return;
            }

            changeTheme(currentTheme);
            loadPsychologyTip();
            startTipTimer();
            
            // Listen for auth state changes
            window.firebase.onAuthStateChanged(window.firebase.auth, async (user) => {
                if (user) {
                    currentUser = user;
                    await loadUserData();
                    showMainApp();
                    showView('log');
                } else {
                    currentUser = null;
                    showAuthScreen();
                }
            });
        }

        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('show');
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // ESC to close modals
            if (event.key === 'Escape') {
                document.querySelectorAll('.modal.show').forEach(modal => {
                    modal.classList.remove('show');
                });
            }
            
            // Enter to submit forms
            if (event.key === 'Enter' && !event.shiftKey) {
                if (document.getElementById('loginForm').classList.contains('hidden') === false) {
                    event.preventDefault();
                    login();
                } else if (document.getElementById('registerForm').classList.contains('hidden') === false) {
                    event.preventDefault();
                    register();
                }
            }
        });

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Wait a bit for Firebase to load
            setTimeout(initApp, 500);
        });

        // Error boundary for better debugging
        window.addEventListener('error', function(event) {
            console.error('Global error:', event.error);
        });

        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
        });
    </script>
</body>
</html>
